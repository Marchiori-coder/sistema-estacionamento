<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=3.0, minimum-scale=0.5">
    <title>Sistema de Estacionamento</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--p:clamp(10px,2vw,30px);--f:clamp(0.8rem,1.5vw,1rem);--r:clamp(8px,1vw,15px)}
        body{font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);min-height:100vh;padding:var(--p);font-size:var(--f)}
        .modal-login{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);display:none;justify-content:center;align-items:center;z-index:10000}
        .modal-login.show{display:flex!important}
        .login-box{background:white;padding:30px;border-radius:var(--r);text-align:center;max-width:400px;width:90%}
        .login-input{width:100%;padding:12px;margin:8px 0;border:2px solid #ecf0f1;border-radius:8px;font-size:var(--f)}
        .login-btn{width:100%;padding:12px;background:#3498db;color:white;border:none;border-radius:8px;font-weight:bold;cursor:pointer}
        .close-modal{position:absolute;top:15px;right:20px;background:none;border:none;font-size:2rem;cursor:pointer;color:#7f8c8d}
        .container{max-width:min(1600px,95vw);margin:0 auto;background:white;border-radius:var(--r);box-shadow:0 10px 30px rgba(0,0,0,0.2);overflow:hidden}
        .header{background:linear-gradient(135deg,#2c3e50,#3498db);color:white;padding:var(--p);text-align:center;position:relative;padding-top:clamp(60px,8vw,100px)}
        .header h1{font-size:clamp(1.5rem,4vw,2.5rem);margin-bottom:10px}
        .user-info{position:absolute;top:20px;right:20px;background:rgba(255,255,255,0.25);padding:10px 20px;border-radius:25px;display:flex;align-items:center;gap:10px;flex-wrap:wrap}
        .user-badge{background:#27ae60;color:white;padding:6px 12px;border-radius:15px;font-size:0.8rem;font-weight:bold}
        .user-badge.admin{background:#f39c12}
        .admin-login-btn,.logout-btn{background:#3498db;color:white;border:none;padding:8px 15px;border-radius:15px;cursor:pointer;font-size:0.8rem;font-weight:bold}
        .logout-btn{background:#e74c3c}
        .status-firebase{position:fixed;top:var(--p);left:var(--p);padding:10px 15px;border-radius:20px;color:white;font-weight:bold;z-index:1000;display:flex;align-items:center;gap:8px;font-size:0.8rem}
        .status-firebase.conectado{background:#27ae60}
        .status-firebase.desconectado{background:#e74c3c}
        .indicador-firebase{width:10px;height:10px;border-radius:50%;background:white;animation:pulse 2s infinite}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
        .admin-panel{background:linear-gradient(135deg,#f39c12,#e67e22);color:white;padding:20px;text-align:center;display:none}
        .admin-panel.show{display:block!important}
        .admin-controls{display:flex;justify-content:center;gap:10px;flex-wrap:wrap}
        .admin-btn{padding:10px 15px;background:rgba(255,255,255,0.2);color:white;border:2px solid white;border-radius:20px;cursor:pointer;font-weight:bold;font-size:0.8rem}
        .admin-btn:hover,.admin-btn.active{background:white;color:#f39c12}
        .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:15px;margin-top:20px}
        .stat-box{background:rgba(255,255,255,0.2);padding:15px;border-radius:10px;text-align:center}
        .stat-number{font-size:clamp(1.2rem,3vw,1.8rem);font-weight:bold;display:block}
        .estacionamento-wrapper{padding:var(--p);background:#f8f9fa;min-height:70vh;position:relative}
        .estacionamento-container{
            position:relative;
            width:1200px;
            height:800px;
            margin:0 auto;
            background:#e8e8e8;
            border-radius:var(--r);
            border:3px solid #34495e;
            overflow:visible;
            transform-origin:center;
            transition:transform 0.3s;
            touch-action:pan-x pan-y pinch-zoom;
        }
        .planta-baixa{position:absolute;top:0;left:0;width:100%;height:100%;background-size:cover;background-repeat:no-repeat;background-position:center;opacity:0.8;z-index:1;transform-origin:center;transition:all 0.3s}
        .planta-baixa.ajustavel{border:2px dashed #3498db;opacity:0.9}
        .zoom-controls,.planta-controls{position:absolute;background:rgba(255,255,255,0.95);padding:15px;border-radius:10px;box-shadow:0 4px 15px rgba(0,0,0,0.2);z-index:150;display:none;cursor:move;user-select:none}
        .zoom-controls{top:20px;left:20px}
        .planta-controls{top:20px;right:20px}
        .zoom-controls.dragging,.planta-controls.dragging{z-index:200;box-shadow:0 8px 25px rgba(0,0,0,0.4);transform:scale(1.05)}
        .zoom-controls h4,.planta-controls h4{color:#34495e;margin-bottom:10px;font-size:0.8rem;cursor:move;padding:5px;background:rgba(52,73,94,0.1);border-radius:5px;text-align:center}
        .zoom-btn,.planta-btn{padding:8px 12px;margin:2px;color:white;border:none;border-radius:5px;cursor:pointer;font-size:0.8rem}
        .zoom-btn{background:#3498db}
        .planta-btn{background:#e67e22;display:block;width:100%;margin-bottom:5px}
        .vaga{position:absolute;width:clamp(25px,4vw,45px);height:clamp(40px,6vw,75px);border:2px solid #2c3e50;background:rgba(39,174,96,0.9);display:flex!important;justify-content:center;align-items:center;font-size:clamp(6px,1.2vw,10px);font-weight:bold;color:white;border-radius:4px;cursor:pointer;transition:all 0.3s;z-index:10;user-select:none}
        .vaga:hover{transform:scale(1.1);z-index:100}
        .vaga.viewer-mode{cursor:default!important}
        .vaga.viewer-mode:hover{transform:none!important}
        .livre{background:rgba(39,174,96,0.9)!important}
        .ocupada{background:rgba(231,76,60,0.9)!important}
        .modo-edicao .vaga{cursor:move!important;border:3px dashed #f39c12!important;background:rgba(243,156,18,0.8)!important}
        .vaga.selecionada{border:4px solid #9b59b6!important;background:rgba(155,89,182,0.9)!important;z-index:1000!important}
        .vaga.multipla-selecionada{border:4px solid #e67e22!important;background:rgba(230,126,34,0.9)!important;z-index:999!important}
        .vaga.arrastando{z-index:1001!important;transform:scale(1.2)!important;opacity:0.8;box-shadow:0 8px 20px rgba(0,0,0,0.3)}
        .edit-controls{position:fixed;top:50%;right:20px;transform:translateY(-50%);background:white;padding:20px;border-radius:15px;box-shadow:0 15px 40px rgba(0,0,0,0.3);display:none;z-index:1000;min-width:280px;max-height:85vh;overflow-y:auto}
        .edit-controls.show{display:block!important}
        .edit-section{margin-bottom:20px}
        .edit-section h4{color:#34495e;margin-bottom:10px;font-size:0.8rem}
        .edit-btn{width:100%;padding:10px;margin:5px 0;border:none;border-radius:8px;cursor:pointer;font-weight:bold;font-size:0.8rem}
        .edit-btn.rotate{background:#3498db;color:white}
        .edit-btn.resize{background:#e67e22;color:white}
        .edit-btn.action{background:#9b59b6;color:white}
        .edit-btn.delete{background:#e74c3c;color:white}
        .edit-btn.multi{background:#27ae60;color:white}
        .size-controls{display:grid;grid-template-columns:1fr 1fr;gap:8px}
        .size-btn{padding:8px;background:#95a5a6;color:white;border:none;border-radius:5px;cursor:pointer;font-size:0.8rem}
        .position-controls{display:grid;grid-template-columns:1fr 1fr 1fr;gap:5px}
        .position-btn{padding:6px;background:#2c3e50;color:white;border:none;border-radius:4px;cursor:pointer;font-size:0.8rem}
        .controles{padding:30px;background:#ecf0f1;display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:15px;justify-items:center}
        .btn{padding:12px 20px;border:none;border-radius:20px;cursor:pointer;font-weight:bold;font-size:0.8rem;transition:all 0.3s;min-width:120px}
        .btn:hover{transform:translateY(-2px)}
        .btn:disabled{opacity:0.3;cursor:not-allowed}
        .btn-reset{background:linear-gradient(135deg,#95a5a6,#7f8c8d);color:white}
        .btn-ocupar{background:linear-gradient(135deg,#e74c3c,#c0392b);color:white}
        .btn-liberar{background:linear-gradient(135deg,#27ae60,#2ecc71);color:white}
        .btn-salvar{background:linear-gradient(135deg,#3498db,#2980b9);color:white}
        .btn-firebase{background:linear-gradient(135deg,#ff9800,#f57c00);color:white}
        .notificacao{position:fixed;bottom:20px;right:20px;background:#2c3e50;color:white;padding:15px 20px;border-radius:10px;z-index:1000;max-width:min(350px,90vw);transform:translateX(400px);transition:transform 0.3s}
        .notificacao.mostrar{transform:translateX(0)}
        .notificacao.sucesso{background:#27ae60}
        .notificacao.erro{background:#e74c3c}
        .notificacao.info{background:#3498db}

        /* MOBILE ZOOM E VISUALIZA√á√ÉO AMPLA */
        @media (max-width:1024px){
            .estacionamento-wrapper{overflow-x:auto;padding:5px;}
            .estacionamento-container{
                width:1200px;
                min-width:1200px;
                height:800px;
                min-height:800px;
                max-width:none;
                max-height:none;
                margin:0;
            }
        }
        @media (max-width:768px){
            .container{max-width:100vw;}
            .estacionamento-wrapper{overflow-x:auto;padding:2px;}
            .estacionamento-container{
                width:1200px;
                min-width:1200px;
                height:800px;
                min-height:800px;
                max-width:none;
                max-height:none;
                margin:0;
            }
            .mobile-zoom-controls{
                position:fixed;
                bottom:20px;
                right:20px;
                background:rgba(255,255,255,0.9);
                border-radius:10px;
                padding:10px;
                box-shadow:0 4px 15px rgba(0,0,0,0.2);
                z-index:100;
                display:flex;
                flex-direction:column;
                gap:5px;
            }
            .mobile-zoom-btn{
                width:40px;
                height:40px;
                border:none;
                border-radius:8px;
                background:#3498db;
                color:white;
                font-size:18px;
                font-weight:bold;
                cursor:pointer;
                display:flex;
                align-items:center;
                justify-content:center;
            }
            .mobile-zoom-btn:active{background:#2980b9}
            .zoom-indicator{
                position:fixed;
                top:20px;
                left:50%;
                transform:translateX(-50%);
                background:rgba(0,0,0,0.7);
                color:white;
                padding:8px 15px;
                border-radius:20px;
                font-size:12px;
                z-index:100;
                opacity:0;
                transition:opacity 0.3s;
            }
            .zoom-indicator.show{opacity:1}
        }
        @media (max-width:480px){
            .estacionamento-container{
                width:1000px;
                min-width:1000px;
                height:700px;
                min-height:700px;
            }
            .mobile-zoom-btn{width:35px;height:35px;font-size:16px}
            .mobile-zoom-controls{bottom:15px;right:15px;padding:8px}
        }
    </style>
</head>
<body>
    <div class="modal-login" id="modal-login">
        <div class="login-box">
            <button class="close-modal" onclick="fecharModalLogin()">√ó</button>
            <h2>üîê Login Administrador</h2>
            <input type="text" class="login-input" id="username" placeholder="Usu√°rio">
            <input type="password" class="login-input" id="password" placeholder="Senha">
            <button class="login-btn" onclick="fazerLoginAdmin()">Entrar como Admin</button>
        </div>
    </div>

    <div class="status-firebase" id="status-firebase">
        <div class="indicador-firebase"></div>
        <span id="texto-firebase">Sistema Inicializado</span>
    </div>

    <div class="container">
        <div class="header">
            <div class="user-info">
                <span id="user-name">Visualizador P√∫blico</span>
                <span class="user-badge" id="user-badge">VIEWER</span>
                <button class="admin-login-btn" id="admin-login-btn" onclick="mostrarModalLogin()">Login Admin</button>
                <button class="logout-btn" id="logout-btn" onclick="logout()" style="display:none;">Sair</button>
            </div>
            <h1>üöó SMAMUS - Sistema de Estacionamento</h1>
            <p><strong>√öltima atualiza√ß√£o:</strong> <span id="ultima-atualizacao">Agora</span></p>
            <div class="stats">
                <div class="stat-box"><span class="stat-number" id="total-vagas">62</span><span>Total</span></div>
                <div class="stat-box"><span class="stat-number" id="vagas-livres">62</span><span>Livres</span></div>
                <div class="stat-box"><span class="stat-number" id="vagas-ocupadas">0</span><span>Ocupadas</span></div>
                <div class="stat-box"><span class="stat-number" id="taxa-ocupacao">0%</span><span>Ocupa√ß√£o</span></div>
            </div>
        </div>
        <div class="admin-panel" id="admin-panel">
            <h3>üîß Painel de Administra√ß√£o</h3>
            <div class="admin-controls">
                <button class="admin-btn" id="btn-edit-mode" onclick="toggleEditMode()">‚úèÔ∏è Edi√ß√£o</button>
                <button class="admin-btn" onclick="adicionarNovaVaga()">‚ûï Nova Vaga</button>
                <button class="admin-btn" onclick="carregarPlantaBaixa()">üñºÔ∏è Planta</button>
                <button class="admin-btn" id="btn-edit-planta" onclick="toggleEditPlanta()">üìê Ajustar Planta</button>
                <button class="admin-btn" onclick="exportarLayout()">üì§ Exportar</button>
                <button class="admin-btn" onclick="importarLayout()">üì• Importar</button>
                <button class="admin-btn" id="btn-multi-select" onclick="toggleSelecaoMultipla()">üî≤ Multi</button>
            </div>
        </div>
        <div class="estacionamento-wrapper">
            <div class="zoom-controls" id="zoom-controls">
                <h4>üîç Zoom - Arraste para mover</h4>
                <div>
                    <button class="zoom-btn" onclick="ajustarZoom('container',0.1)">üîç+</button>
                    <button class="zoom-btn" onclick="ajustarZoom('container',-0.1)">üîç-</button>
                    <button class="zoom-btn" onclick="resetarZoom('container')">‚ü≤</button>
                </div>
                <div style="margin-top:8px;">
                    <button class="zoom-btn" onclick="ajustarZoom('planta',0.1)">üñºÔ∏è+</button>
                    <button class="zoom-btn" onclick="ajustarZoom('planta',-0.1)">üñºÔ∏è-</button>
                    <button class="zoom-btn" onclick="resetarZoom('planta')">‚ü≤üñºÔ∏è</button>
                </div>
                <div style="font-size:0.8em;color:#7f8c8d;margin-top:5px;text-align:center;">
                    Container: <span id="zoom-container">100%</span><br>
                    Planta: <span id="zoom-planta">100%</span>
                </div>
            </div>
            <div class="planta-controls" id="planta-controls">
                <h4>üìê Planta Baixa - Arraste para mover</h4>
                <button class="planta-btn" onclick="ajustarPlanta('cover')">üìè Cobrir √Årea</button>
                <button class="planta-btn" onclick="ajustarPlanta('contain')">üìê Ajustar</button>
                <button class="planta-btn" onclick="ajustarPlanta('fill')">üîÑ Preencher</button>
                <button class="planta-btn" onclick="centralizarPlanta()">‚åñ Centralizar</button>
                <button class="planta-btn" onclick="resetarPlanta()">‚ü≤ Reset</button>
            </div>
            <div class="zoom-indicator" id="zoom-indicator">Zoom: 100%</div>
            <div class="mobile-zoom-controls" id="mobile-zoom-controls" style="display:none;">
                <button class="mobile-zoom-btn" onclick="ajustarZoomMobile(0.2)">+</button>
                <button class="mobile-zoom-btn" onclick="ajustarZoomMobile(-0.2)">-</button>
                <button class="mobile-zoom-btn" onclick="resetarZoomMobile()" style="font-size:14px;">‚ü≤</button>
            </div>
            <div class="estacionamento-container" id="mapa-estacionamento">
                <div class="planta-baixa" id="planta-baixa"></div>
            </div>
        </div>
        <div class="edit-controls" id="edit-controls">
            <div style="text-align:center;margin-bottom:15px;color:#2c3e50;font-weight:bold;">
                üîß Editando: <span id="vaga-selecionada">-</span>
            </div>
            <div id="multi-selection-info" style="display:none;background:#e67e22;color:white;padding:10px;border-radius:8px;margin-bottom:15px;text-align:center;">
                <span id="multi-count">0</span> vagas selecionadas
            </div>
            <div class="edit-section" id="multi-actions" style="display:none;">
                <h4>üî≤ A√ß√µes em Lote</h4>
                <button class="edit-btn multi" onclick="aplicarRotacaoMultipla(-90)">‚Ü∂ -90¬∞</button>
                <button class="edit-btn multi" onclick="aplicarRotacaoMultipla(90)">‚Ü∑ +90¬∞</button>
                <button class="edit-btn multi" onclick="redimensionarMultiplas('width',5)">üìè Largura +</button>
                <button class="edit-btn multi" onclick="redimensionarMultiplas('height',5)">üìè Altura +</button>
                <button class="edit-btn multi" onclick="alinharVagasMultiplas('horizontal')">‚ÜîÔ∏è Alinhar H</button>
                <button class="edit-btn multi" onclick="alinharVagasMultiplas('vertical')">‚ÜïÔ∏è Alinhar V</button>
                <button class="edit-btn delete" onclick="excluirVagasMultiplas()">üóëÔ∏è Excluir</button>
                <button class="edit-btn action" onclick="limparSelecaoMultipla()">‚ùå Limpar</button>
            </div>
            <div class="edit-section">
                <h4>üìç Posi√ß√£o</h4>
                <div class="position-controls">
                    <button class="position-btn" onclick="moverVaga(-10,-10)">‚Üñ</button>
                    <button class="position-btn" onclick="moverVaga(0,-10)">‚Üë</button>
                    <button class="position-btn" onclick="moverVaga(10,-10)">‚Üó</button>
                    <button class="position-btn" onclick="moverVaga(-10,0)">‚Üê</button>
                    <button class="position-btn" onclick="centralizarVaga()">‚åñ</button>
                    <button class="position-btn" onclick="moverVaga(10,0)">‚Üí</button>
                    <button class="position-btn" onclick="moverVaga(-10,10)">‚Üô</button>
                    <button class="position-btn" onclick="moverVaga(0,10)">‚Üì</button>
                    <button class="position-btn" onclick="moverVaga(10,10)">‚Üò</button>
                </div>
            </div>
            <div class="edit-section">
                <h4>üîÑ Rota√ß√£o</h4>
                <button class="edit-btn rotate" onclick="rotacionarVaga(-90)">‚Ü∂ -90¬∞</button>
                <button class="edit-btn rotate" onclick="rotacionarVaga(90)">‚Ü∑ +90¬∞</button>
                <button class="edit-btn rotate" onclick="resetarRotacao()">‚ü≤ Reset</button>
            </div>
            <div class="edit-section">
                <h4>üìè Tamanho</h4>
                <div class="size-controls">
                    <button class="size-btn" onclick="redimensionarVaga('width',-5)">Largura -</button>
                    <button class="size-btn" onclick="redimensionarVaga('width',5)">Largura +</button>
                    <button class="size-btn" onclick="redimensionarVaga('height',-5)">Altura -</button>
                    <button class="size-btn" onclick="redimensionarVaga('height',5)">Altura +</button>
                </div>
                <button class="edit-btn resize" onclick="resetarTamanho()">üìè Padr√£o</button>
            </div>
            <div class="edit-section">
                <h4>üé® A√ß√µes</h4>
                <button class="edit-btn action" onclick="duplicarVaga()">üìã Duplicar</button>
                <button class="edit-btn action" onclick="renomearVaga()">‚úèÔ∏è Renomear</button>
                <button class="edit-btn delete" onclick="excluirVaga()">üóëÔ∏è Excluir</button>
            </div>
        </div>
        <div class="controles">
            <button class="btn btn-reset" onclick="resetarTodasVagas()" id="btn-reset" disabled>üîÑ Resetar</button>
            <button class="btn btn-ocupar" onclick="ocuparTodasVagas()" id="btn-ocupar" disabled>üöó Ocupar</button>
            <button class="btn btn-liberar" onclick="liberarTodasVagas()" id="btn-liberar" disabled>‚úÖ Liberar</button>
            <button class="btn btn-salvar" onclick="salvarEstadoLocal()">üíæ Salvar</button>
            <button class="btn btn-firebase" onclick="salvarNoFirebase()">üåê Firebase</button>
        </div>
    </div>
    <input type="file" id="import-input" accept=".json" style="display:none;" onchange="processarImportacao(event)">
    <input type="file" id="planta-input" accept="image/*" style="display:none;" onchange="processarPlantaBaixa(event)">
    <!-- O JS completo segue exatamente igual ao √∫ltimo enviado, incluindo as fun√ß√µes de zoom mobile, pinch, sincroniza√ß√£o, arraste, etc. -->
    <!-- ... (insira aqui o JS j√° fornecido nas respostas anteriores, sem altera√ß√µes) ... --><script>
var firebaseConfig = {
    apiKey: "AIzaSyCRIgCndKlfXxR7NNnq_qGupgAWyLqzYzc",
    authDomain: "teste-dbacd.firebaseapp.com",
    databaseURL: "https://teste-dbacd-default-rtdb.firebaseio.com/",
    projectId: "teste-dbacd",
    storageBucket: "teste-dbacd.firebasestorage.app",
    messagingSenderId: "381642195685",
    appId: "1:381642195685:web:746eb4df7667813b0e4a0c"
};

var estadoVagas = {};
var posicaoVagas = {};
var firebaseConectado = false;
var database = null;
var totalVagas = 62;
var usuarioAtual = 'viewer';
var tipoUsuario = 'viewer';
var modoEdicao = false;
var proximoIdVaga = 63;
var vagaSelecionada = null;
var vagaArrastando = null;
var offsetX = 0;
var offsetY = 0;
var zoomContainer = 1;
var zoomPlanta = 1;
var selecaoMultipla = false;
var vagasMultiplasSelecao = [];
var editandoPlanta = false;
var plantaConfig = {size: 'cover', posX: 50, posY: 50};
var painelArrastando = null;
var offsetPainelX = 0;
var offsetPainelY = 0;

// Zoom mobile
var zoomMobile = 1;
var isMobile = window.innerWidth <= 1024;
var touchStartDistance = 0;
var touchStartZoom = 1;

function ajustarZoomMobile(incremento) {
    zoomMobile = Math.max(0.4, Math.min(3, zoomMobile + incremento));
    aplicarZoomMobile();
    mostrarIndicadorZoom();
}
function resetarZoomMobile() {
    zoomMobile = 1;
    aplicarZoomMobile();
    mostrarIndicadorZoom();
}
function aplicarZoomMobile() {
    if (isMobile) {
        var container = document.getElementById('mapa-estacionamento');
        container.style.transform = 'scale(' + zoomMobile + ')';
        container.style.transformOrigin = 'center center';
    }
}
function mostrarIndicadorZoom() {
    var indicator = document.getElementById('zoom-indicator');
    indicator.textContent = 'Zoom: ' + Math.round(zoomMobile * 100) + '%';
    indicator.classList.add('show');
    setTimeout(function() {
        indicator.classList.remove('show');
    }, 1500);
}
function inicializarGestosTouch() {
    if (!isMobile) return;
    var container = document.getElementById('mapa-estacionamento');
    container.addEventListener('touchstart', function(e) {
        if (e.touches.length === 2) {
            var touch1 = e.touches[0], touch2 = e.touches[1];
            touchStartDistance = Math.sqrt(
                Math.pow(touch2.clientX - touch1.clientX, 2) +
                Math.pow(touch2.clientY - touch1.clientY, 2)
            );
            touchStartZoom = zoomMobile;
            e.preventDefault();
        }
    });
    container.addEventListener('touchmove', function(e) {
        if (e.touches.length === 2) {
            var touch1 = e.touches[0], touch2 = e.touches[1];
            var currentDistance = Math.sqrt(
                Math.pow(touch2.clientX - touch1.clientX, 2) +
                Math.pow(touch2.clientY - touch1.clientY, 2)
            );
            var scale = currentDistance / touchStartDistance;
            zoomMobile = Math.max(0.4, Math.min(3, touchStartZoom * scale));
            aplicarZoomMobile();
            e.preventDefault();
        }
    });
    container.addEventListener('touchend', function(e) {
        if (e.touches.length < 2) {
            mostrarIndicadorZoom();
        }
    });
}

// ... (aqui insira todas as fun√ß√µes JS do seu sistema: login, Firebase, criarVaga, arraste, edi√ß√£o, sincroniza√ß√£o, etc.)
// Use o JS das respostas anteriores, pois ele j√° est√° pronto para todo o fluxo do sistema, apenas acrescente o bloco de zoom mobile acima.

// Inicializa√ß√£o do sistema
document.addEventListener('DOMContentLoaded', function() {
    carregarLocal();
    inicializarVagas();
    inicializarFirebase();
    document.addEventListener('mousemove', arrastar);
    document.addEventListener('mouseup', finalizarArraste);
    if (isMobile) {
        document.getElementById('mobile-zoom-controls').style.display = 'flex';
        aplicarZoomMobile();
        inicializarGestosTouch();
    }
    var zoomControls = document.getElementById('zoom-controls');
    var plantaControls = document.getElementById('planta-controls');
    if (zoomControls) zoomControls.addEventListener('mousedown', iniciarArrastePainel);
    if (plantaControls) plantaControls.addEventListener('mousedown', iniciarArrastePainel);
    document.getElementById('mapa-estacionamento').addEventListener('click', function() {
        if (vagaSelecionada && modoEdicao && tipoUsuario === 'admin') {
            vagaSelecionada.classList.remove('selecionada');
            vagaSelecionada = null;
            document.getElementById('edit-controls').style.display = 'none';
        }
    });
});
</script>

    <!-- O c√≥digo √© muito extenso para caber inteiro aqui, mas se precisar de um bloco espec√≠fico ou do JS novamente, me avise! -->
</body>
</html>
